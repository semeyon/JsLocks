var Locker=function(){};Locker.locks={},Locker._lockQueue={},Locker._runningQueue={},Locker._init=function(n,t,i){t===undefined&&(t=0),Locker.locks[n]===undefined?Locker.locks[n]=i,Locker._lockQueue[n]===undefined&&(Locker._lockQueue[n]=[]),Locker._runningQueue[n]===undefined&&(Locker._runningQueue[n]=!1)},Locker._process=function(n,t){Locker._prioritizeQueue(n),Locker._runningQueue[n]||Locker._wait(n,t)},Locker._wait=function(n,t){var r,i;if(Locker._runningQueue[n]=!0,r=Locker.locks[n],r>0){if(Locker.locks[n]++,i=Locker._lockQueue[n].shift(),i===undefined){t==0&&Locker.locks[n]--,Locker._runningQueue[n]=!1;return}i[0]!==undefined&&i[0].call(this),t==0&&Locker.locks[n]--}setTimeout(function(){Locker._wait(n,t)},20)},Locker._prioritizeQueue=function(n){var t=Locker._lockQueue[n].sort(function(n,t){return n[1]-t[1]});Locker._lockQueue[n].length===t.length?Locker._lockQueue[n]=t:Locker._prioritizeQueue(n)},Locker.Lock=function(n,t,i){Locker._init(n,i,1),Locker._lockQueue[n].push([t,-i]),Locker._process(n,0)},Locker.LockManual=function(n,t,i){Locker._init(n,i,1),Locker._lockQueue[n].push([t,-i]),Locker._process(n,1)},Locker.Release=function(n){Locker.locks[n]++},Locker.DiscardQueue=function(n){Locker._lockQueue[n]=[]},Locker.LockManualIfInstant=function(n,t,i){Locker._lockQueue[n].length===0&&Locker.locks[n]&&Locker.LockManual(n,t,i)},Locker.LockIfInstant=function(n,t,i){Locker._lockQueue[n].length===0&&Locker.locks[n]&&Locker.Lock(n,t,i)},Locker.MultiLock=function(n,t,i){var u,r;for(Locker._init(n,t,0),u=function(){},r=0;r<i;r++)Locker._lockQueue[n].push([u,-t]);Locker._process(n,1)},Locker.ZeroLock=function(n,t){Locker.MultiLock(n,t,0)};
